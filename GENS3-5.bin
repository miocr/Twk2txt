PRILOHA 2 ¥REZERVOVANA SLOVA, MNEMONIKA ATD. ÷Zde je uveden seznam rezervovanych slov v ¥ramci ¥GENS ¥3. ¥Tytosymboly nesmeji byt pouzity jako navesti, ale mohou tvorit ¥castnavesti. Vsimnete si, ze rezervovana slova jsou tvorena ¥velkymipismeny. ÿÀA ¨B ¨C ¨D ¨E ¨H ¨L ¨I ¨R ¨$ ìAF ­AF' ¬BC ­DE ­HL ¬IX æIY ­SP ­NC ­Z ®NZ ¬M çP ®PE ­PO ÿ®Nyni nasleduje seznam platne mnemoniky ¥Z80, ¥prikazu ¥a ¥poveluas¥embleru. Rovnez tato musi byt vkladana velkymi pismeny. éADC §AD¥ ¨AND ¨BIT ¨CAL¥ §C¥F §CP ¨CPD §CPDR ãCPI §CPIR §CPL ¨DA¥ ¨DEC ¨DI ¨DJNZ ¦EI ¨EX åEX¥ §HALT §IM ©IN ©INC ¨IND §INDR ¦INI §INIR ãJP ¨JR ©LD ©LD¥ ¨LD¥R §LDI §LDIR ¦NEG §NOP äOR ¨OTDR §OTIR §OUT ¨OUTD §OUTI ¦POP §PUSH ¦RES äRET §RETI §RETN §RL ©RLA ¨RLC §RLCA ¦RLD §R¥ åPRA §R¥C ¨R¥CA §R¥D ¨RST ¨SBC §SCF §SET §SLA äSRA §SRL ¨SUB ¨XOR ÿîDEFB ¦DEFM §DEFS §DEFW §ELSE §END §ENT §EQU §IF åORG ÿÿª*D ¨*E ©*H ©*L ©*S ©*C ¨*F ÿØPRILOHA 3 ¥FUNKCNI PRIKLAD ÿ®Nyni nasleduje ¥priklad ¥typickeho ¥pouziti ¥GENS ¥3 ¥- ¥jste-lizacatecnik programovani v as¥embleru nebo jste-li trochu nejistiv pouzivani editor/as¥embleru, pak doporucujeme ¥pozorne ¥projit¥ento priklad. Vsimnete si, ze ENTER oznacuje, ze mate stisknoutENTER na klavesnici. ÿ´Cil cviceni: ×Napsat a vyzkouset rychlou rutinu pro nasobeni ¥celych ¥cisel ¥aulozit jeji text na pasku pomoci prikazu editoru 'T', aby ¥mohlabyt lehce vlozena do pozdejsich programu. úPostup cviceni: Ô1. Napsat rutinu nasobeni jako podprogram a ulozit ji ¥na ¥paskupomoci prikazu editoru 'P', aby mohla byt ¥lehce ¥znovu ¥nahranapri tomto cviceni pro odstraneni chyb, pokud se vyskytnou. ©2. Odstranit chyby v podprogramu, upravit pokud bude treba. ¨3. Ulozit bezchybny podprogram na pasku pouzitim prikazu editoru'T', tak aby mohl byt 'vlozen' do pozdejsich programu. íNez zacneme musime nahrat GENS ¥3 ¥do ¥pocitace ¥- ¥udelejte ¥tovlozenim LOAD "¥CODE 24064 k ulozeni as¥embleru na adresu 24064.Nyni vlozte RANDOMIZE USR 24064 a jako odpoved na dotaz ¥'Buf¥ersize?' vlozte 1 nasledovanou ENTER, tim ¥se ¥vytvori ¥'vkladaci'pamet velikosti 1*256 bytu. Nyni se objevi '>' - jste v ¥editorupripraveni vytvorit program. ÿ¬Cast 1 - napsani rutiny pro nasobeni. ¾Pouzijeme prikazu editoru 'I' k vlozeni textu ¥uzitim ¥CI ¥(znaktabelace) k ziskani tabelovaneho zobrazeni. Nemusime pouzit CI aziskame vzdy vypis tabelovany. Neni oznaceno kde je ¥pouzit ¥CI,ale predpokladame, ¥ze ¥pred ¥mnemonikou ¥a ¥mezi ¥mnemonikou ¥aoprandem. Uvedomte si, ze adresy uvedene ve ¥vypisu ¥as¥embleru,ktery nasleduje, nemusi odpovidat adresam ¥vytvorenym ¥na ¥vasempocitaci; jsou uvedeny pouze pro ilustraci. û1¥0,10 ENTER Ù10 ;A fast integer multiply ENTER Â20 ;routine. Multiplies HL ENTER Ã30 ;by DE. Return the result ENTER Á40 ;in HL. C flag set on an ENTER Â50 ;overflow. ENTER Ð60 ENTER Û70 «ORG ¥#7F0¥ ENTER É80 ENTER Û90 Mult ¦OR ¦A ENTER Ì10¥ «SBC ¥HL,DE ;HL>DE ENTER Á1¥0 «AD¥ ¥HL,DE ENTER È120 «JR ¦NC,Mu1 ;yes ENTER Â130 «EX ¦DE,HL ENTER È140 Mu1 §OR ¦D ENTER Ì150 «SCF ;overflow if ENTER Â160 «RET ¥NZ ;DE>25¥ ENTER Ã170 «OR ¦E ;times 0?ENTER Ã180 «LD ¦E,D ENTER Ê190 «JR ¦NZ,MU4 ;no ENTER Ã20¥ «EX ¦DE,HL ;0 ENTER Å210 «RET ENTER Ï2¥0 ENTER Ú230 ;Main routine. ENTER Ë240 ENTER Ú250 Mu2 §EX ¦DE,HL ENTER È260 «AD¥ ¥HL,DE ENTER È270 «EX ¦DE,HL ENTER È280 Mu3 §AD¥ ¥HL,HL ENTER È290 «RET ¥C ;overflow ENTER Â30¥ Mu4 §R¥A ENTER Ï310 «JR ¦NC,Mu3 ENTER Ç320 «OR ¦A ENTER Ì3¥0 «JR ¦NZ,Mu2 ENTER Ç340 «AD¥ ¥HL,DE ENTER È350 «RET ENTER Ï360 C¥ Û>P10,350,Mult ENTER ÿ³Toto vytvori text a ulozi jej na pasku. Pamatujte, ze magnetofonmusi byt spusten pred vlozenim prikazu 'P'. øCast 2 - odstraneni chyb v programu ÀNejprve ¥se ¥presvedcime, ¥zda ¥probehla ¦spravne §kompilace.Pouzijeme cin¥osti 6, takze se neprovede vypis ¥a ¥nevytvori ¥sestrojni kod. ÿ¼>A ENTER ÛTable size: ENTER ¦(standardni hodnota velikosti tabulky symb.)Options: 6 ENTER ÿ¸*HISOFT GENS3 AS¥EMBLER* ÌCopyright Hisoft 1983 ÏAl¥ Rights Reserved ÿ³Pas¥ 1 er¥ors: 0¥ ÿ·Pas¥ 2 er¥ors: 0¥ Ò*WARNING* MU4 ¥absent ÎTable used: ¨74 ¥from §161 Ä> ÿÇZ teto kompilace vidime, ze jsme udelali chybu ¥v ¥radku ¥190 ¥avlozili MU4 namisto Mu4, ktere je pouzite navesti. Upravime tedyradek 190: Ù>F190,190,MU4,Mu4 ENTER Î190 «JR ¦NZ, ¥(nyni uzijte povelu 'S') ´> ÿÇNyni provedeme kompilaci jeste jednou a ta by mela byt bez chybya musime vlozit kod pro odzkouseni rutiny: ¹>N30¥,10 ENTER ¦(precislovani pro vlozeni dalsiho textu) ª>1¥0,10 ENTER Ù10 ;kod pro zkouseni ENTER É20 ;the Mult routine. ENTER È30 ENTER Û40 «LD ¦HL,50 ENTER É50 «LD ¦DE,20 ENTER É60 «CAL¥ MULT ;Multiply ENTER À70 «LD ¦A,H ;o/p result ENTER ¿80 «CAL¥ Aout ENTER Ê90 «LD ¦A,L ENTER Ê10¥ «CAL¥ Aout ENTER É1¥0 «RET ;Return to editor ENTER ½120 ENTER Ú130 ;Routine to o/p A in hex ENTER Á140 ENTER Ú150 Aout ¦PUSH AF ENTER Ë160 «R¥CA ENTER Î170 «R¥CA ENTER Î180 «R¥CA ENTER Î190 «RECA ENTER Î20¥ «CAL¥ Nib¥le ENTER Ç210 «POP ¥AF ENTER Ë2¥0 Nib¥le AND ¥%1§ ENTER È230 «AD¥ ¥A,#90 ENTER È240 «DA¥ ENTER Ï250 «ADC ¥A,#40 ENTER È260 «DA¥ ENTER Ï270 «LD ¦IY,#5C3A ;for ROM ENTER ¼280 «RST ¥#10 ;ROM cal¥ ENTER À290 «RET ENTER Ï30¥ C¥ Û> ÿÇNyni zkompilujte zkusebni rutinu spolu s rutinou pro nasobeni. å>A áTable size: ENTER ÒOptions: 6 ENTER ÿ¸*HISOFT GENS3 AS¥EMBLER* ÌCopyright HISOFT 1983 ÏAl¥ rights reserved ÿ³7EAC ¥190 «RECA Î*ER¥OR* 02 ¨(hit any key to continue) ûPas¥ 1 er¥ors: 01 ÒTable used: §8¥ ¥from ¦210 ÿ«Mame chybu v teto rutine; RECA ma byt R¥CA v radku 190. Tedy: ¦>E190 à190 ®RECA Ñ190 ¯C(enter change mode)R ENTER ENTER ñNyni provedte kompilaci znovu pomoci cin¥osti 4 (bez ¥vypisu) ¥atext bude kompilovan bezchybne. Nyni jsme ¥pripraveni ¥vyzkousetcin¥ost programu pro masobeni a je treba sdelit editoru odkud sema spustit program. To provedeme pseudoinstrukci ENT: ®>35 ¬ENT ¦$ ENTER ÿ¯Nyni provedeme kompilaci jeste jednou a ¥mela ¥by ¥byt ¥ukoncenazpravou: ÛTable used: ¨8¥ ¦from §21¥ ÃExecutes: 32416 Ô> ânebo podobnou. Nyni muzeme spustit program prikazem editoru 'R'.Ocekavame nasobeni 50 krat 20 coz je 10¦ nebo #3E8 hex. «>R ENTER Û0¥32> ÿÃNepracuje! Proc? Vypiste radky 380 az 50¥ (L380,50¥). Uvidite naradku 430 ¥instrukci ¥OR ¥D ¥nasledovanou ¥RET ¥NZ. ¥To ¥zpusobilogickou operaci OR mezi registrem D a akumulatorem A a navrat schybou ¥(stavovy ¥registr ¥C ¥nataven) ¥v ¥pripade §nenulovehovysledku. Podstatou ¥toho ¥je ¥zjistit ¥zda ¥DE<256 ¥a ¥nasobeninezpusobi preplneni - to se provede kontrolou zda D je nulovy.¦ale OR pracuje spravne ¥jen ¥tehdy, ¥kdyz ¥akumulator ¥A ¥je ¥nazacatku nulovy a toto zde neni zajisteno. Musime zajistit, aby Abyl nulovy pred provedenim OR D, jinak ziskame nepredpoveditelnepreplneni ¥s ¥navratem ¥vetsiho ¥cisla ¥nez ¥je ¥vysledek. ¦Priprohlidce kodu vidime, ze OR A ¥na ¥radku ¥380 ¥muzeme ¥nahraditinstrukci XOR A a tim nastavit stavove registry pro SBC HL,DE ¥asoucasne nulovat A. Takze: É>F380 ENTER Ú380 Mult ¨OR ¦A Ð380 ­I(enter insert mode)X ENTER ENTER ³> âNyni provedeme opet kompilaci (cin¥ost ¥4) ¥a ¥spustime ¥programpouzitim 'R'. Odpoved by nyni mela byt spravna - #3EB. ­Muzeme nyni provest dalsi kontrolu zmenou radku 40 a 50 ke zmenecinitelu pak kompilovat a spustit - zjistime, ze rutina ¥pracujeperfektne. ÙPo provereni rutiny ji muzeme ulozit ¥na ¥pasku ¥ve ¥'vkladacim'formatu: Û>T30¥,9¦,Mult ENTER ÏNezapomente spustit ¥magnetofon ¥na ¥nahravani ¥pred ¥stisknutimENTER. Takto ulozena rutina muze byt vlozena do programu takto: §50¥ «RET Õ510 à520 ;Vlozit rutinu Mult zde. Ç530 à540 *F Mult Ø5¥0 à560 ;Dalsi rutina ÏPo kompilaci tohoto textu se objevi 'Start tape.¥', ¥kdyz ¥dojdena radek 540 pri obou prubezich. Musite prehrat Mult z ¥pasky ¥vobou pripadech. To znamena previnout pasek ¥po ¥prvnim ¥prubehu.Muzete vsak na pasek nahrat Mult 2x za sebou a pro druhy ¥prubehpouzit druhou nahravku. ÿ±Prostudujte prosim peclive tento priklad a sami jej provedte.