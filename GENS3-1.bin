 ½OBSAH: ÿ¨CAST 1 ¦GENS 3 ÝKAPITOLA 1 ¨SPUSTENI ¿1 ¯KAPITOLA 2 ¨PODROBNOSTI GENS 3 µ1 ¸2.0 ¦Jak pracuje GENS 3 µ1 ¸2.1 ¦Format as¥emblerovych instrukci ¨4 ¸2.2 ¦Navesti (labels) ·4 ¸2.3 ¦Citac adres ¼5 ¸2.4 ¦Tabulka symbolu ¸5 ¸2.5 ¦Vyrazy Á5 ¸2.6 ¦Ridici povely as¥embleru ¯6 ¸2.7 ¦Podminene pseudoinstrukce ®7 ¸2.8 ¦Prikazy as¥embleru µ7 ¯KAPITOLA 3 ¨EDITOR Á9 ¸3.1 ¦Uvod do editoru ¸9 ¸3.2 ¦Prikazy editoru ·10 ¸3.2.1 Vkladani textu ¸10 ¸3.2.2 Vypis textu »10 ¸3.2.3 Uprava textu º10 ¸3.2.4 Prikazy pro pasku µ12 ¸3.2.5 Kompilace a spusteni ²12 ¸3.2.6 Ostatni prikazy ·13 ¸3.3 ¦Priklad pouziti editoru ¯14 ¯PRILOHA 1 ©CHYBOVA HLASENI A JEJICH VYZNAM §15 ¯PRILOHA 2 ©REZERVOVANA SLOVA, MNEMONIKA ATD. ¥16 ¯PRILOHA 3 ©FUNKCNI PRIKLAD ·16 ÿËCAST 2 ¦MONS 3 ÝKAPITOLA 1 ¨SPUSTENI ¾20 ¯KAPITOLA 2 ¨POUZIVANE PRIKAZY µ21 ¾'SYMBOL SHIFT 3' ¶21 ¾'SYMBOL SHIFT 4' nebo '$' ­21 ¾'ENTER' ¿21 ¾'CAPS SHIFT 7' ¸21 ¾'CAPS SHIFT 5' ¸21 ¾'CAPS SHIFT 8' ¸21 ¾',' (carka) »21 ¾'G' Ã21 ¾'H' Ã2¥ ¾'I' Ã2¥ ¾'J' Ã2¥ ¾'SYMBOL SHIFT K' ¶2¥ ¾'L' Ã23 ¾'M' Ã23 ¾'N' Ã23 ¾'O' Ã23 ¾'P' Ã23 ¾'Q' Ã24 ¾'SYMBOL SHIFT T' ¶24 ¾'T' Ã24 ¾'U' Ã26 ¾'V' Ã26 ¾'W' Ã26 ¾'X' Ã27 ¾'Y' Ã27 ¾'SYMBOL SHIFT Z' ¶27 ¾Priklad krokovani µ28 ¾'SYMBOL SHIFT P' ¶29 ¾Zmeny obsahu pameti ³29 ¾Zmeny obsahu registru ±30 ¯PRILOHA «PRIKLAD ZOBRAZENI CELNIHO PANELU ¦31 ÿÿÿâG¦ §E¨ ¦N ¦N §S¦ §3¦ ÀG ¦G ¦E ªN ¦N ¦S ¦S ¥3 ¦3 ¿G ªE ªN¥ ¥N §S ¬3 ¿G ªE¦ ¨N N N ¨S ©3¥ ÀG ¥G¥ ¦E ªN ¥N¥ ©S ª3 ¿G ¦G ¦E ªN ¦N ¦S ¦S ¥3 ¦3 ÀG¦ §E¨ ¦N ¦N §S¦ §3¦ ÿÙKAPITOLA 1 §SPUSTENI ÿ²GENS 3 je vyborny a ¥jednoduse ¥pouzitelny ¥as¥embler ¥pro ¥Z80,ktery je velice blizky standardnimu as¥embleru ZILOG. Na ¥rozdilod mnoha jinych as¥embleru pro mikropocitace je GENS 3 ¥rozsahlyprofesionalni software a ¥doporucujeme ¥prostudovat ¥nasledujicikapitoly spolu s prikladem v priloze 3 velmi pozorne jeste ¥predpouzitim as¥embleru. Jste-li uplny zacatecnik, zacnete ¥nejdriveprilohou 3. ÛGENS 3 je dlouhy zhruba 7kbyte a pouziva svou vlastni vnitrnizasobnikovou pamet takze je zcela sobestacny. ¥Obsahuje ¥vlastniradkovy editor, ktery umistuje textovy soubor ihned ¥za ¥GENS ¥3CODE, zatimco tabulka symbolu as¥embleru se ¥tvori ¥za ¥textovymsouborem. Pri nahrani GENS 3 musite tudiz nechat dostatek ¥mistapro vlastni as¥embler, tabulku symbolu a text, ktery budete ¥pripraci potrebovat. Je proto ¥vhodne ¥umistit ¥GENS ¥3 ¥do ¥spodnicasti pameti. ÙNahrani GENS 3 se provadi nasledovne: »'LOAD "GENS3" CODE x¨' ENTER - kde x¨ je dekadicka ¥adresaod ktere chcete GENS 3 umistit a spoustet. ¼Jakmile je do pocitace nahran ¥GENS ¥3, ¥muzete ¥vstoupit ¥doas¥embleru pomoci 'RANDOMIZE USR x¨', kde x¨ je adresa, odktere byl GENS 3 nahran. Je-li treba ¥kdykoli ¥pozdeji ¥vstoupitopet do as¥embleru, je ¥nutne ¥pouzit ¥adresu ¥x¨ ¥+ ¥56 ¥prostudeny start (dojde k vyprazdneni) nebo x¨ + ¥61 ¥pro ¥teplystart (zachova se vytvoreny text). Je nutne si uvedomit, ze presadresu x¨ se spusti ¥GENS ¥3 ¥pouze ¥jednou, ¥nebot ¥dojde ¥krozmisteni strojniho kodu. ÌNapr.: chcete-li nahrat GENS 3 od adresy ¥#5E0¥ ¥(nebo ¥24064dekadicky) - postupujte nasledovne: ÀLOAD "GENS3"CODE 24064 ÍRANDOMIZE USR 24064 ÿ¸Pro novy studeny ¥start ¥pouzijte ¥'RANDOMIZE ¥USR ¥24120' ¥a'RANDOMIZE USR 24125' k teplemu startu. ¿Kdyz spustite GENS 3 poprve adresou x¨, objevi ¥se ¥zprava'Buf¥er size?': mate vlozit cislo od 0 do 9 vcetne, ¥nasledovaneENTER nebo pouze ENTER, kdy se predpoklada standardni hodnota 4.Vlozene cislo nebo standardni hodnota urcuje velikost pameti provkladani v jednotkach 256 bytu (viz kapitola 2.8 - vkladani). ¦Chcete-li ¥minimalizovat ¦prostor §zabrany §GENS §3 §(anepotrebujete-li vyuzit moznost vkladani) vlozte 0 ¥nasledovanouENTER - tim se vytvori nejmensi mozny prostor, t.j. 64 bytu. ªPo zodpovezeni teto otazky se objevi znak '>', ze ¥editor ¥jepripraven - podivejte ¥se ¥do ¥kapitoly ¥3, ¥jak ¥vkladat ¥a ¥dokapitoly 2 co vkladat. ÐDulezite upozorneni! : ¥Z ¥duvodu ¥vetsi ¥rychlosti a lepsihospojeni je blokovano preruseni. To ¥znamena, ¥ze ¥kazdy ¥programvyzadujici preruseni musi byt vybaven instrukci pro preruseni ¦(EI) drive nez toto ¥bude ¥pozadovano. ¥Gens ¥3 ¥rovnez ¥vyuzivaregistr IY. ÿ½KAPITOLA 2 §PODROBNOSTI GENS 3 ÿ¨2.0 Jak pracuje GENS 3 ÿµGENS 3 je rychly as¥embler pro Z80 se ¥dvema ¥prubehy, ¥kterylze prizpusobit vetsine systemu se Z80. Zahrnuje kompilaci vsechstandardnich instrukci Z80 a je vybaven dalsimi ¥moznostmi ¥jakoje podminena kompilace a ¥mnoho ¥as¥emblerovych ¥prikazu ¥vcetnebinarne vetvene tabulky symbolu. ÆSpustite-li as¥embler ¥(prikazem ¥'A' ¥- ¥viz ¥kap. ¥3) ¥jstenejprve dotazan na velikost tabulky 'Table size:' (dekadicky). ¥Je to prostor pameti, ktery ¥bude ¥vyhrazen ¥tabulce ¥symbolu ¥vprubehu cin¥osti. Pri pouhem stisknuti ENTER ¥si ¥GENS ¥3 ¥zvolistandardni velikost, kterou ¥povazuje ¥za ¥primerenou ¥velikostitextu - zpravidla uplne postaci. Uvedomte si, ze pri vkladani jetreba zvolit vetsi prostor pro tabulku symbolu nez ¥je ¥normalnivelikost; as¥embler nemuze predvidat objem souboru, ¥ktery ¥budevlozen. ßPo textu 'Table size:' se vas program dotaze, ¥jakou ¥cin¥ost'Options:' pozadujete. Vlozte dekadicky soucet indexu cin¥osti vpripade, ze pozadujete vice ¥nez ¥jeden ¥typ ¥podle ¥nasledujicitabulky: ÿÀCin¥ost 1 ¦Tvorba seznamu pouzitych symbolu ¥na ¥konci ¥druheho ¯prubehu as¥embleru ÅCin¥ost 2 ¦Zabraneni generace strojniho kodu ¶Cin¥ost 4 ¦Zabraneni vypisu vysledku kompilace ´Cin¥ost 8 ¦Nasmerovani vypisu kompilace na tiskarnu ¯Cin¥ost 16 ¥Umisteni strojniho kodu za ¥tabulku ¥symbolu. ¥Citac ¯adresy ¥je ¥stale ¥aktualizovan ¥pomoci ¥ORG, ¥takze ¯strojni kod muze byt umisten v jedne ¥casti ¥pameti, ¯ale pracovat muze jinde ÀCin¥ost 32 ¥Vypnuti kontroly umisteni strojniho kodu - ¥uzitecne ¯pro zrychleni kompilace ÿ¥Priklad: Cin¥ost 36 provede rychlou kompilaci- bez vypisu a ¥bezkontroly, kam bude strojni kod umisten. ¿Pri pouziti cin¥osti 16 nelze pouzit prikaz ¥as¥embleru ¥ENT.Muzete vsak zjistit umisteni ¥strojniho ¥kodu ¥pouzitim ¥prikazu'X', ktery nalezne konec textu (druhe zobrazene cislo) a k ¥nemupricteme velikost tabulky symbolu +2. ÁKompilace se provadi ve dvou prubezich; behem prvniho prubehuGENS 3 hleda chyby ¥a ¥kompiluje ¥tabulku ¥symbolu, ¥pri ¥druhemprubehu se vytvori strojni kod (pokud neni zvolena ¥cin¥ost ¥2).Behem prvniho prubehu ¥se ¥na ¥obrazovce ¥ani ¥na ¥tiskarne ¥nicnezobrazi pokud neni objevena chyba. V pripade chyby se ¥zobrazichybny radek a pod nim pocet chyb (viz priloha 1). Kompilace ¥jeprerusena - stisknutim 'E' se provede ¥navrat ¥do ¥editoru ¥nebolibovolnym jinym tlacitkem se pokracuje od nasledujiciho radku. äNa konci prvniho prubehu se objevi zprava: ÃPas¥ 1 er¥ors: n¥ ÿ°V pripade chyby se as¥embler zastavi a neprovede ¥2. ¥prubeh.Uzije-li se symbolu v ¥poli ¥opeandu, ¥ktery ¥neni ¥definovan ¥vtabulce, objevi se zprava '*WARNING* label ¥absent' ¥pro ¥kazdouchybejici definici. ÓVe druhem prubehu se vytvori strojni kod (pokud ¥tvorbe ¥nenizamezeno - cin¥ost 2). V tomto prubehu se rovnez ¥vytvori ¥vypisvysledku kompilace pokud nebyla zvolena cin¥ost ¥4 ¥nebo ¥prikazas¥embleru *L-. Vypis ma tvar: ÿ´C0¦ 21010¥ ©25 label ÞLD §HL,1 Å1 §6 «15 §21 §26 ýNa prvnim miste je hodnota citace adres, ¥ktera ¥udava ¦zacatekzpracovani tohoto radku, pokud ¥nejsou ¥pouzity ¥pseudoinstrukcejako ORG, EQU nebo ENT (viz kapitola ¥2.6). ¥Zpravidla ¥je ¥udanhexadecimalne, ale muze byt zobrazen i dekadicky uzitim ¥prikazu*D+ (viz kapitola 2.8). ÏNa druhem miste, od sloupce 6, je az 8 znaku (predstavujicich4 byty) instrukce - ale vsimnete si prikazu *C uvedeneho nize. ¨Nasleduje cislo radku - cele ¥cislo ¥v ¥rozmezi ¥1 ¥az ¥32767vcetne. ßSloupce 21 - 26 prvniho radku ¥obsahuji ¥prvnich ¥sest ¥znakunavesti definovaneho na tomto radku. ÂNasledujici dva odstavce se ¥tykaji ¥pouze ¥systemu ¥s ¥uzkouobrazovkou. Systemy s delkou radku vetsi nez 40 maji kazdy radekas¥embleru uveden na jednom radku obrazovky. ºPo kazdem navesti nasleduje novy radek - na ¥nem ¥je ¥uvedenainstrukce ve sloupcich 21 ¥- ¥24. ¥Nasleduje ¥pole ¥operandu ¥odsloupce 26 a nakonec komentar, ktery je vkladan na konec radku ageneruje novy radek pokud je to nutne. ÀUvedeny ¥format ¥usnadnuje ¥citelnost ¥u ¥systemu ¥s §uzkouobrazovkou jako je ¥SPECTRUM. ¥GENS ¥3 ¥nemeni ¥pocet ¥znaku ¥naobrazovce, nebot by to vyzadovalo rozsireni GENS 3 a ¥nebylo ¥bymozno pouzit standardni rutiny v ROM. ÁPrikaz as¥embleru *C muze byt ¥pouzit ¥ke ¥zkraceni ¥radku ¥azpusobi vynechani 9 znaku predstavujicich strojni ¥kod ¥radku ¥aumozni zobrazeni vice radku na obrazovce (viz kapitola 2.8 nize) ¦Je mozna modifikace formatu radky zapsanim pomoci POKE do trimist GENS 3. Podrobnosti jsou ¥uvedeny ¥dale. ¥Rozlisujeme ¥meziradkem as¥embleru a radkem obrazovky, coz je to co je ¥videt ¥naobrazovce. ¥Radek ¥as¥embleru ¥je ¥zpravidla ¥vic ¦nez §radekobrazovky. Ü1. ¥'Start ¥GENS ¥3 ¥+ ¥51 ¥(#3¥)' ¥urci, ¥na ¥ktere ¦pozici(sloupec-5) skonci prvni radek vystupu as¥embleru. Zmenou tohotobytu na 0 se vytvori nepreruseny radek (uzitecne ¥u ¥tiskaren ¥sdlouhym radkem) nebo na hodnotu <256 k ukonceni ¥radku ¥na ¥danepozici sloupce. ×2. 'Start GENS 3 + 52 (#34)' udava sloupec (pocitano ¥od ¥1),kde ma zacinat nasledujici radek na obrazovce. ¸3. 'Start GENS 3 + 53 (#35)' udava ¥kolik ¥znaku, ¥zbylych ¥zradku, ma byt zobrazeno ¥na ¥obrazovce ¥po ¥prvnim ¥obrazovkovemradku. àJako ¥priklad ¥predpokladejme, ¥ze ¥pozadujeme ¦pro §prvniobrazovkovy radek 20 znaku (t.j. bez pole navesti a potom ¥kazdynasledujici obrazovkovy radek ma zacinat na pozici 1 ¥a ¥vyplnitcely radek. Take predpokladame, ze jste nahrali GENS 3 od adresy#5E0¥ nebo 24064 dekadicky. ¥K ¥vyvolani ¥techto ¥zmen ¥provedtenasledujici: ÞPOKE 241¥5,20 ÖPOKE 241¥6,1 §na zacatku nasledujiciho obrazovkoveho ­POKE 241¥7,31 ¦radku musi byt alespon jedna mezera ìVyseuvedene zmeny lze provest jen kdyz ¥nebyl ¥pouzit ¥prikaz*C- tento prikaz zpusobi v pripade potreby scrol¥. ´Vystup ¥as¥embleru ¥lze ¥prerusit ¥na ¥konci ¥kazdeho ¦radkustisknutim CAPS SHIFT a SPACE - nasledujicim stisknutim ¥'E' ¥sevracime ¥do ¥editoru ¥nebo ¥stisknutim ¦libovolneho §tlacitkapokracujeme ve vystupu. ÏJedina chyba, ke ktere ¥muze ¥dojit ¥pri ¥druhem ¥prubehu ¥je*ER¥OR* 10 (viz priloha 1) ¥a ¥'Bad ¥ORG!' ¥(v ¥pripade, ¥ze ¥bystrojni kod prepsal GENS 3, tabulku symbolu nebo textovy ¥soubor- toto vyhodnoceni muze byt vypnuto uzitim cin¥osti 32. ¥*ER¥OR*10 neni podstatna a muzete pokracovat v kompilaci. Zatimco chybyjako 'Bad ORG!' jsou podstatne a ihned vrati rizeni do editoru. §Zprava na konci druheho prubehu: ØPas¥ 2 er¥ors: n¥ ºse zobrazi nejdrive a po ni ¥nasleduje ¥pripadne ¥upozorneni ¥nachybejici navesti ¥- ¥viz ¥vyse. ¥Nyni ¥se ¥zobrazi ¥nasledujicizprava: îTable used: x¨ from y¨ µktera nas informuje o tom jaka cast tabulky symbolu byla vyuzitave srovnani s rezervovanym mistem. ÄV tomto miste, byl-li spravne pouzit prikaz ¥ENT, ¥se ¥objevizprava 'Executes n¨'. Ta ¥udava ¥pocatecni ¥adresu ¥strojnihokodu, ktery muzete spustit prikazem 'R'. Pozor na pouziti tohoto